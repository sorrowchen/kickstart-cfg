# Kickstart file automatically generated by anaconda.
# modified for our base install

install
network --bootproto=dhcp --nodns --noipv6
nfs --server=172.16.210.1 --dir=/kickstart/os/RH/EL_5.7_x86_64
lang en_GB.UTF-8
keyboard uk
skipx
key --skip
text
reboot

rootpw --iscrypted $1$eeBKH.q7$ussjLYlxi55gBdMtmjldu1
# add standard account (me)

firewall --disabled
selinux --disabled
authconfig --enableshadow --enablemd5 
timezone --utc Europe/London

zerombr yes
bootloader --location=mbr

# get disk layout - generated by %pre
%include /tmp/part-include
# standard package list

%include /tmp/Default_users.cfg
%include /tmp/Default_packages_RHEL_5.7.cfg

%pre

mkdir -p /tmp/users/
wget -O /tmp/Default_users.cfg http://172.16.210.1/kickstart/CFG/users/Default_users.cfg
wget -O /tmp/Default_packages_RHEL_5.7.cfg  http://172.16.210.1/kickstart/CFG/Default_packages_RHEL_5.7.cfg
wget -O /tmp/part-include  http://172.16.210.1/kickstart/CFG/disk_layouts/EFIN.cfg

mkdir /kickstart
mount -o ro,nolock -t nfs 172.16.210.1:/kickstart  /kickstart

#### 
%post --log=/mnt/sysimage/root/ks-post-nc.log --nochroot

/mnt/sysimage//usr/sbin/pvcreate /dev/sd[bcd]
/mnt/sysimage//usr/sbin/vgextend system /dev/sdb
/mnt/sysimage//usr/sbin/vgcreate -ff tier1 /dev/sdc
/mnt/sysimage//usr/sbin/vgcreatei -ff  tier2 /dev/sdd

for p in e f g h i j k l m n o p q r s t u v w x y z
do

if [ -e /dev/sd${p} ] ; then

dd if=/dev/zero of=/dev/sd${p} bs=1M count=10
/mnt/sysimage//usr/sbin/pvcreate /dev/sd${p}

if [ "$p" == "c" ] ; then
 /mnt/sysimage//usr/sbin/vgcreate data /dev/sd${p}
elif [ "$p" == "b" ]  ; then
 /mnt/sysimage//usr/sbin/vgcreate swap /dev/sd${p}
else [ -e /dev/sd${p} ]
 /mnt/sysimage//usr/sbin/vgcreate data_${p} /dev/sd${p}
fi

fi

done


####
%post --log=/mnt/sysimage/root/ks-post-nc.log --nochroot





mkdir -p /mnt/sysimage/mnt/nfs
mount -o ro,nolock -t nfs 172.16.210.1:/kickstart  /mnt/sysimage/mnt/nfs

%post --log=/root/ks-post-cr.log
/mnt/nfs/scripts/finish/default_finish_CentOS 2>&1 | tee /root/ks-script.log



