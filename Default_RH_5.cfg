# Kickstart file automatically generated by anaconda.
# modified for our base install

install
network --bootproto=dhcp --noipv6
#nfs --server=build --dir=/kickstart/os/RH/EL_5.7_x86_64
lang en_GB.UTF-8
keyboard uk
skipx
key --skip
text
#cmdline
reboot

rootpw --iscrypted $1$eeBKH.q7$ussjLYlxi55gBdMtmjldu1
# add standard account (me)

firewall --disabled
selinux --disabled
authconfig --enableshadow --enablemd5 
timezone --utc Europe/London



#zerombr
clearpart --all --initlabel --drives=sda,sdb
ignoredisk --drives=sdc,sdd,sde
bootloader --location=mbr --driveorder=sda
part /boot --fstype "ext3" --size=512 --ondisk=sda --asprimary --grow
part pv.01 --size=1 --grow --ondisk=sdb --asprimary
volgroup system pv.01


logvol  / --vgname=system --fstype ext3 --size=8192  --name=root --fsoptions="rw,noatime"  
logvol  /home --vgname=system --fstype ext3 --size=1024 --grow --maxsize=4096 --name=home --fsoptions="rw,noatime"
logvol  /var  --vgname=system --fstype ext3 --size=4096 --grow --maxsize=8192  --name=var  --fsoptions="rw,noatime"
logvol  /tmp  --vgname=system --fstype ext3 --size=1024 --grow --maxsize=2048  --name=tmp  --fsoptions="rw,noatime"
logvol  /opt  --vgname=system --fstype ext3 --size=3072 --grow --maxsize=16384 --name=opt  --fsoptions="rw,noatime"
logvol  swap  --vgname=system --fstype swap --size=1024 --grow --maxsize=8192  --name=swap






# standard package list

%include /tmp/Default_users.cfg
%include /tmp/Default_packages_RHEL_5.7.cfg

%pre

mkdir -p /tmp/users/
wget -O /tmp/Default_users.cfg http://build/kickstart/CFG/users/Default_users.cfg
wget -O /tmp/Default_packages_RHEL_5.7.cfg  http://build/kickstart/CFG/Default_packages_RHEL_5.7.cfg

mkdir /kickstart
mount -o ro,nolock -t nfs build:/kickstart  /kickstart

wget -O /tmp/part-include http://build/kickstart/CFG/disk_layouts/RHEL5.cfg

for d in a b c d
do
        dd if=/dev/zero of=/dev/sd$d bs=1M count=10
done


#### 
%post --log=/mnt/sysimage/root/ks-post-nc.log --nochroot


if [ -e /dev/sdc ] ; then
 dd if=/dev/zero of=/dev/sdc bs=1M count=10
 lvm.static pvcreate /dev/sdc
 lvm.static vgcreate t1 /dev/sdc
fi

if [ -e /dev/sdd ] ; then
 dd if=/dev/zero of=/dev/sdd bs=1M count=10
 lvm.static pvcreate /dev/sdd
 lvm.static vgcreate t2 /dev/sdd
fi

if [ -e /dev/sde ] ; then
 dd if=/dev/zero of=/dev/sde bs=1M count=10
 lvm.static pvcreate /dev/sde
 lvm.static vgcreate t1.1 /dev/sde
fi

%post --log=/mnt/sysimage/root/ks-post-nc.log --nochroot
mkdir -p /mnt/sysimage/mnt/nfs
mount -o ro,nolock -t nfs build:/kickstart  /mnt/sysimage/mnt/nfs


%post --log=/root/ks-post-cr.log
/mnt/nfs/scripts/finish/default_finish_CentOS 2>&1 | tee /root/ks-script.log



