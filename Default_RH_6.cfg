# Kickstart file automatically generated by anaconda.
# modified for our base install

install
network --bootproto=dhcp --nodns --noipv6
nfs --server=build --dir=/kickstart/os/Centos/6/
#repo --name=epel --baseurl=http://download.fedoraproject.org/pub/epel/6/x86_64/ --proxy=http://=build:3128
lang en_GB.UTF-8
keyboard uk
skipx
text
reboot

rootpw --iscrypted $1$eeBKH.q7$ussjLYlxi55gBdMtmjldu1
# add standard account (me)
user --name=cscott --groups=root --password=letmein --shell=/bin/bash --uid=1087
user --name=sci115bew  --password=h0lycr4p!  --groups=root  --shell=/bin/bash

firewall --disabled
selinux --disabled
authconfig --enableshadow --enablemd5 
timezone --utc Europe/London

zerombr yes
bootloader --location=mbr

# get disk layout - generated by %pre
%include http://build/kickstart/CFG/disk_layouts/RHEL6.cfg
# standard package list 

%include http://build/kickstart/CFG/users/Default_users.cfg
%include http://build/kickstart/CFG/Default_packages_6.x.cfg


%pre

mkdir /kickstart
mount -o ro,nolock -t nfs build:/kickstart  /kickstart
for d in a b c d
do
	dd if=/dev/zero of=/dev/sd$d bs=1M count=10
done

#### 
%post --log=/mnt/sysimage/root/ks-post-nc.log --nochroot



if [ -e /dev/sdb ] ; then
 dd if=/dev/zero of=/dev/sdb bs=1M count=10
 /mnt/sysimage/sbin/pvcreate /dev/sdb
# /mnt/sysimage/usr/sbin/vgextend system /dev/sdb
fi

if [ -e /dev/sdc ] ; then
 dd if=/dev/zero of=/dev/sdc bs=1M count=10
 /mnt/sysimage/sbin/pvcreate /dev/sdc
 /mnt/sysimage/sbin/vgcreate t1 /dev/sdc
fi

if [ -e /dev/sdd ] ; then
 dd if=/dev/zero of=/dev/sdd bs=1M count=10
 /mnt/sysimage/sbin/pvcreate /dev/sdd
 /mnt/sysimage/sbin/vgcreate t2 /dev/sdd
fi






mkdir -p /mnt/sysimage/mnt/nfs
mount -o ro,nolock -t nfs build:/kickstart  /mnt/sysimage/mnt/nfs

%post --log=/root/ks-post-cr.log 
/mnt/nfs/scripts/finish/default_finish_CentOS 2>&1 | tee /root/ks-script.log



#sleep 300

